<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>CFLIB - Flexible Configuration Library: Advanced Usage Example</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">CFLIB - Flexible Configuration Library
   &#160;<span id="projectnumber">Patchlevel 21</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.8.0 -->
<script type="text/javascript" src="dynsections.js"></script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">Advanced Usage Example </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Setup <a class="el" href="config_initializer.html">Configuration Initializer</a>, generate Report and save <a class="el" href="config_files.html">Configuration Files</a></p>
<div class="fragment"><pre class="fragment">
<span class="comment">/*</span>
<span class="comment"> *    Generate Report from Template and Configuration</span>
<span class="comment"> *</span>
<span class="comment"> *    Input:  - Commandline, Environment, Section in System Configuration File,</span>
<span class="comment"> *              Private Configuration File, Standard Input for Variables.</span>
<span class="comment"> *            - Text Template (Form).</span>
<span class="comment"> *</span>
<span class="comment"> *    Output: - Generated Report (Filled Form) to File or stdout,</span>
<span class="comment"> *            - Configuration to Private Configuration File, Logfile or</span>
<span class="comment"> *              Standard Output</span>
<span class="comment"> */</span>

<span class="preprocessor">#include &lt;stdio.h&gt;</span>

<span class="preprocessor">#include &quot;../../include/cf.h&quot;</span>

<span class="preprocessor">#define DEF_SETFILE &quot;~/fill.cnf&quot;</span>
<span class="preprocessor"></span><span class="preprocessor">#define DEF_SYS_SETFILE &quot;/etc/cfcommon.cnf&quot;</span>
<span class="preprocessor"></span>
<span class="keywordtype">int</span> main( <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv )
{
    <span class="keywordtype">int</span> ecode;
    <span class="keywordtype">char</span> *save, *infile, *outfile, line[<a class="code" href="group__cflib__core.html#gaf78e4b950c9aa49b752e4460342ea3bf" title="Maximum string length for error message.">CF_MAXERRSTR</a>+1];
    <span class="keywordtype">char</span> *savemode = <span class="stringliteral">&quot;w&quot;</span>;
    FILE *error_log = stderr;

    <span class="comment">/* Hardcoded Configuration Setup and Defaults */</span>
    <a class="code" href="struct_c_o_n_f_i_g.html" title="CFLIB Configuration Database Entry.">CONFIG</a> setting[] =
    {   { <span class="stringliteral">&quot;FILL_INFILE&quot;</span>,   <a class="code" href="group__cflib__core.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="NULL, if not defined.">NULL</a>,             <span class="charliteral">&#39;i&#39;</span>, 0x0,                        },
        { <span class="stringliteral">&quot;FILL_OUTFILE&quot;</span>,  <a class="code" href="group__cflib__core.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="NULL, if not defined.">NULL</a>,             <span class="charliteral">&#39;o&#39;</span>, 0x0,                        },
        { <span class="stringliteral">&quot;FILL_VARDELIM&quot;</span>, <span class="stringliteral">&quot;$()&quot;</span>,            <span class="charliteral">&#39;l&#39;</span>, <a class="code" href="group__special__options__mask.html#ga9e526dae88bf6803772107ff283637b5" title="Argument is concatenated to option.">CF_CONCAT</a>,                  },
        { <span class="stringliteral">&quot;verb&quot;</span>,          <a class="code" href="group__cflib__core.html#ga7010abac2c80c121772da4d9c03332ee" title="Flag is not set.">CF_FLAG_OFF</a>,      <span class="charliteral">&#39;v&#39;</span>, <a class="code" href="group__special__options__mask.html#ga72b75851880f36aaa5a52fdfe7960cca" title="Do not check environment for variable.">CF_IGN_ENV</a>|<a class="code" href="group__special__options__mask.html#ga1d1f1d1b6eac6b5d9970102318ab2667" title="Entry is Flag.">CF_FLAG</a>,         },
        { <span class="stringliteral">&quot;help&quot;</span>,          <a class="code" href="group__cflib__core.html#ga7010abac2c80c121772da4d9c03332ee" title="Flag is not set.">CF_FLAG_OFF</a>,      <span class="charliteral">&#39;h&#39;</span>, <a class="code" href="group__special__options__mask.html#ga72b75851880f36aaa5a52fdfe7960cca" title="Do not check environment for variable.">CF_IGN_ENV</a>|<a class="code" href="group__special__options__mask.html#ga1d1f1d1b6eac6b5d9970102318ab2667" title="Entry is Flag.">CF_FLAG</a>|<a class="code" href="group__special__options__mask.html#gad76153c65f68cc0ee5c1a04c8c3e80bf" title="Don&#39;t include in savefile / mark entry.">CF_NOSAVE</a>,},
        { <span class="stringliteral">&quot;query&quot;</span>,         <a class="code" href="group__cflib__core.html#ga7010abac2c80c121772da4d9c03332ee" title="Flag is not set.">CF_FLAG_OFF</a>,      <span class="charliteral">&#39;q&#39;</span>, <a class="code" href="group__special__options__mask.html#ga72b75851880f36aaa5a52fdfe7960cca" title="Do not check environment for variable.">CF_IGN_ENV</a>|<a class="code" href="group__special__options__mask.html#ga1d1f1d1b6eac6b5d9970102318ab2667" title="Entry is Flag.">CF_FLAG</a>,         },
        { <span class="stringliteral">&quot;TIME&quot;</span>,          <a class="code" href="group__cflib__core.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="NULL, if not defined.">NULL</a>,             <span class="charliteral">&#39;t&#39;</span>, <a class="code" href="group__special__options__mask.html#ga0fde537a92deb77f75b21c9e8d306509" title="Time string.">CF_TIME</a>|<a class="code" href="group__special__options__mask.html#ga8d6cd1608fef5638efe964da63edf2dd" title="Source: Function Call.">CF_SET_PUT</a>,         },
        { <span class="stringliteral">&quot;DATE&quot;</span>,          <a class="code" href="group__cflib__core.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="NULL, if not defined.">NULL</a>,             <span class="charliteral">&#39;d&#39;</span>, <a class="code" href="group__special__options__mask.html#ga1c5b511a34d2c0db6631539ba81a4386" title="Date string.">CF_DATE</a>|<a class="code" href="group__special__options__mask.html#ga8d6cd1608fef5638efe964da63edf2dd" title="Source: Function Call.">CF_SET_PUT</a>,         },
        { <span class="stringliteral">&quot;FILL_CNF&quot;</span>,      DEF_SETFILE,      <span class="charliteral">&#39;p&#39;</span>, <a class="code" href="group__special__options__mask.html#gafeeb63d4d8c498bec4a237ad8b94f02f" title="Entry is Private Configuration File.">CF_SETFILE</a>,                 },
        { <span class="stringliteral">&quot;FILL_SAVE&quot;</span>,     <a class="code" href="group__cflib__core.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="NULL, if not defined.">NULL</a>,             <span class="charliteral">&#39;s&#39;</span>, <a class="code" href="group__special__options__mask.html#ga72b75851880f36aaa5a52fdfe7960cca" title="Do not check environment for variable.">CF_IGN_ENV</a>|<a class="code" href="group__special__options__mask.html#ga9e526dae88bf6803772107ff283637b5" title="Argument is concatenated to option.">CF_CONCAT</a>,       },
        { <span class="stringliteral">&quot;SAVE_DATA&quot;</span>,     <a class="code" href="group__cflib__core.html#ga7010abac2c80c121772da4d9c03332ee" title="Flag is not set.">CF_FLAG_OFF</a>,      <span class="charliteral">&#39;x&#39;</span>, <a class="code" href="group__special__options__mask.html#ga1d1f1d1b6eac6b5d9970102318ab2667" title="Entry is Flag.">CF_FLAG</a>|<a class="code" href="group__special__options__mask.html#ga72b75851880f36aaa5a52fdfe7960cca" title="Do not check environment for variable.">CF_IGN_ENV</a>,         },
        { <span class="stringliteral">&quot;SFILE&quot;</span>,         DEF_SYS_SETFILE,  <span class="charliteral">&#39; &#39;</span>, <a class="code" href="group__special__options__mask.html#gabb03ea68e07e388da2c1337a1582c72e" title="Entry is System Configuration File.">CF_SYS_SETFILE</a>,             },
        { <span class="stringliteral">&quot;FILL_SECTION&quot;</span>,  <span class="stringliteral">&quot;fill_default&quot;</span>,   <span class="charliteral">&#39;c&#39;</span>, <a class="code" href="group__special__options__mask.html#ga603f0467f101b71f5f869381429ffef4" title="Section in Configuration File.">CF_SECTION</a>|<a class="code" href="group__special__options__mask.html#gaa4d82cea91ede4aee78594417894e368" title="Last entry in settings array.">CF_LAST</a>,         },
    };

    <span class="comment">/* Initialize with Error Reporting */</span>
    <span class="keywordflow">if</span>( <a class="code" href="group__cflib__core.html#ga64fb341565c2ddfccd6669e5e6265a8a" title="cfinit() Initialize Configuration Database">cfinit</a>(setting,argc,argv) &lt; 0 ){
        <span class="keywordflow">while</span>( (ecode=<a class="code" href="group__errors.html#ga2dc49b60b3ec7a82086e60f4b1c41e18" title="cfgeterr() Error Code and Message Inquiry Function">cfgeterr</a>(line,0)) == TRUE )
            fprintf( error_log, <span class="stringliteral">&quot;error %d: %s&quot;</span>, ecode, line );
        fflush(error_log);
        fputs( <a class="code" href="group__retrieval.html#gad3e4e24668cdc111471332a7e79fc897" title="cfgetusg() Get Usage Message for (Terminal) Output">cfgetusg</a>(), stderr );
        <span class="keywordflow">return</span> (-1);
    }

    <span class="comment">/* User Help and Configuration Overview */</span>
    <span class="keywordflow">if</span>( <a class="code" href="group__retrieval.html#gac0188464b59267e14b5c44efb1d4a0f2" title="Inquire CFLIB DB for Flag value in content of named entry.">cfgetflag</a>(<span class="stringliteral">&quot;help&quot;</span>) ){
        fputs( <a class="code" href="group__retrieval.html#gad3e4e24668cdc111471332a7e79fc897" title="cfgetusg() Get Usage Message for (Terminal) Output">cfgetusg</a>(), stderr );
        <span class="keywordflow">if</span>( <a class="code" href="group__retrieval.html#gac0188464b59267e14b5c44efb1d4a0f2" title="Inquire CFLIB DB for Flag value in content of named entry.">cfgetflag</a>(<span class="stringliteral">&quot;verbose&quot;</span>) ){
            fprintf( stderr, <span class="stringliteral">&quot;\nConfiguration Library PL %d - %s\n\nCurrent Configuration:\n\n&quot;</span>,
                             <a class="code" href="group__retrieval.html#gac4e376e3630e9b25655ee0e0b1a54a5b" title="cfgetvers() Get Library Version/Patchlevel">cfgetvers</a>(), <a class="code" href="group__retrieval.html#ga9999522b2acf8760f420d2567e7f7c50" title="Get CFLIB Copyright Notice.">cfgetcpr</a>() );
            <a class="code" href="group__advanced__features.html#gaecfc8ee37366e1b36cb5aac0cc41ebdc" title="cfdump() Dump CFLIB DB content to fout ">cfdump</a>(stderr);
            fputs( <span class="stringliteral">&quot;\nSources: 1=update function call, 2=commandline argument, 4=environment variable,\n&quot;</span>, stderr );
            fputs(   <span class="stringliteral">&quot;         8=private setfile, 10=system setfile, 20=built-in default, 40=interactive terminal input\n&quot;</span>, stderr );
        }
        <span class="keywordflow">return</span> (1);
    }

    <span class="keywordflow">switch</span>(
        <a class="code" href="group__report__generation.html#ga2695585ee0a7485da6075848fa27a33f" title="cfform() Process a Template from file or stdin and write generated Report to File or stdout ...">cfform</a>( infile = <a class="code" href="group__retrieval.html#ga8cf5f53c5b05ec5ca4f5145010f84eb4" title="Inquire CFLIB DB for String in content of named entry.">cfgetstr</a>(<span class="stringliteral">&quot;FILL_INFILE&quot;</span>),
                outfile = <a class="code" href="group__retrieval.html#ga8cf5f53c5b05ec5ca4f5145010f84eb4" title="Inquire CFLIB DB for String in content of named entry.">cfgetstr</a>(<span class="stringliteral">&quot;FILL_OUTFILE&quot;</span>),
                <a class="code" href="group__retrieval.html#ga8cf5f53c5b05ec5ca4f5145010f84eb4" title="Inquire CFLIB DB for String in content of named entry.">cfgetstr</a>(<span class="stringliteral">&quot;FILL_VARDELIM&quot;</span>),
                <a class="code" href="group__retrieval.html#gac0188464b59267e14b5c44efb1d4a0f2" title="Inquire CFLIB DB for Flag value in content of named entry.">cfgetflag</a>(<span class="stringliteral">&quot;query&quot;</span>) )
    ){
        <span class="keywordflow">case</span> <a class="code" href="group__errors.html#gaa3d4c51112fd70d482a4a77c95dc3daf" title="File Not Found, read access error.">CFE_FNF</a>:
            fprintf(stderr,<span class="stringliteral">&quot;read access error: %s\n&quot;</span>,infile); <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="group__errors.html#gad1375fe531ed1c13233e2fa7ae55534f" title="Write Access Error.">CFE_WAE</a>:
            fprintf(stderr,<span class="stringliteral">&quot;write access error: %s\n&quot;</span>,outfile); <span class="keywordflow">break</span>;
    }

    <span class="keywordflow">if</span>( <a class="code" href="group__retrieval.html#gac0188464b59267e14b5c44efb1d4a0f2" title="Inquire CFLIB DB for Flag value in content of named entry.">cfgetflag</a>(<span class="stringliteral">&quot;verb&quot;</span>) ){
        <span class="keywordflow">if</span>( outfile == <a class="code" href="group__cflib__core.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="NULL, if not defined.">NULL</a> ) outfile = <span class="stringliteral">&quot;&lt;stdout&gt;&quot;</span>;
        fprintf( stderr, <span class="stringliteral">&quot;blank form: %s, filled form: %s\n&quot;</span>, infile, outfile );
    }

    <span class="keywordflow">if</span>( <a class="code" href="group__retrieval.html#gac0188464b59267e14b5c44efb1d4a0f2" title="Inquire CFLIB DB for Flag value in content of named entry.">cfgetflag</a>(<span class="stringliteral">&quot;SAVE_DATA&quot;</span>) ){
        <a class="code" href="group__setting__saving.html#ga0f6ed90e3ecfa0074af1635a0e4339ef" title="cfnosave() Alter or query the CF_NOSAVE Flag of Parameter name ">cfnosave</a>(<a class="code" href="group__cflib__core.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="NULL, if not defined.">NULL</a>, <a class="code" href="group__cflib__core.html#ga355c714f2912ac336b8b03468c978d8c" title="Flag is set.">CF_FLAG_ON</a>);
        <a class="code" href="group__setting__saving.html#ga0f6ed90e3ecfa0074af1635a0e4339ef" title="cfnosave() Alter or query the CF_NOSAVE Flag of Parameter name ">cfnosave</a>(<span class="stringliteral">&quot;TIME&quot;</span>, <a class="code" href="group__cflib__core.html#ga7010abac2c80c121772da4d9c03332ee" title="Flag is not set.">CF_FLAG_OFF</a>);
        <a class="code" href="group__setting__saving.html#ga0f6ed90e3ecfa0074af1635a0e4339ef" title="cfnosave() Alter or query the CF_NOSAVE Flag of Parameter name ">cfnosave</a>(<span class="stringliteral">&quot;DATE&quot;</span>, <a class="code" href="group__cflib__core.html#ga7010abac2c80c121772da4d9c03332ee" title="Flag is not set.">CF_FLAG_OFF</a>);
    }
    <span class="keywordflow">if</span>( (save = <a class="code" href="group__retrieval.html#ga8cf5f53c5b05ec5ca4f5145010f84eb4" title="Inquire CFLIB DB for String in content of named entry.">cfgetstr</a>(<span class="stringliteral">&quot;FILL_SAVE&quot;</span>)) != <a class="code" href="group__cflib__core.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="NULL, if not defined.">NULL</a> ){
        <span class="keywordflow">if</span>( <a class="code" href="group__retrieval.html#gac0188464b59267e14b5c44efb1d4a0f2" title="Inquire CFLIB DB for Flag value in content of named entry.">cfgetflag</a>(<span class="stringliteral">&quot;SAVE_DATA&quot;</span>) ) savemode = <span class="stringliteral">&quot;a&quot;</span>;
        <span class="keywordflow">if</span>( *save == <span class="charliteral">&#39;\0&#39;</span> )
            <a class="code" href="group__setting__saving.html#gaad7e1267cd904b4480a0eeaeb03b5f75" title="cfsave() Write configuration data to a Configuration File or stdout ">cfsave</a>( <a class="code" href="group__cflib__core.html#ga070d2ce7b6bb7e5c05602aa8c308d0c4" title="NULL, if not defined.">NULL</a>, savemode );
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( *save == <span class="charliteral">&#39;+&#39;</span> )
            <a class="code" href="group__setting__saving.html#gaad7e1267cd904b4480a0eeaeb03b5f75" title="cfsave() Write configuration data to a Configuration File or stdout ">cfsave</a>( <span class="stringliteral">&quot;&quot;</span>, savemode );
        <span class="keywordflow">else</span>
            <a class="code" href="group__setting__saving.html#gaad7e1267cd904b4480a0eeaeb03b5f75" title="cfsave() Write configuration data to a Configuration File or stdout ">cfsave</a>( save, savemode );
    }

    <span class="keywordflow">return</span> (0);
}
</pre></div> </div></div><!-- contents -->
<hr size="1"><div align="right"><small>documentation generated by
<a href="http://www.doxygen.org/index.html"><strong>doxygen</strong></a> 1.5.8
for <a href="http://cflib.berlios.de"><strong>CFLIB PL 21</strong></a> [2013/03]</small></div>
</body>
</html>
