<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>CFLIB - Flexible Configuration Library: Advanced Usage Example</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1><a class="anchor" name="advanced_example">Advanced Usage Example </a></h1>Setup <a class="el" href="config_initializer.html">Configuration Initializer</a>, generate Report and save <a class="el" href="config_files.html">Configuration Files</a><p>
<div class="fragment"><pre class="fragment">
<span class="comment">/*</span>
<span class="comment"> *    Generate Report from Template and Configuration</span>
<span class="comment"> *</span>
<span class="comment"> *    Input:  - Commandline, Environment, Section in System Configuration File,</span>
<span class="comment"> *              Private Configuration File, Standard Input for Variables.</span>
<span class="comment"> *            - Text Template (Form).</span>
<span class="comment"> *</span>
<span class="comment"> *    Output: - Generated Report (Filled Form) to File or stdout,</span>
<span class="comment"> *            - Configuration to Private Configuration File, Logfile or</span>
<span class="comment"> *              Standard Output</span>
<span class="comment"> */</span>

<span class="preprocessor">#include &lt;stdio.h&gt;</span>

<span class="preprocessor">#include "../../include/cf.h"</span>

<span class="preprocessor">#define DEF_SETFILE "~/fill.cnf"</span>
<span class="preprocessor"></span><span class="preprocessor">#define DEF_SYS_SETFILE "/etc/cfcommon.cnf"</span>
<span class="preprocessor"></span>
<span class="keywordtype">int</span> main( <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv )
{
    <span class="keywordtype">int</span> ecode;
    <span class="keywordtype">char</span> *save, *infile, *outfile, line[<a class="code" href="group__cflib__core.html#gf78e4b950c9aa49b752e4460342ea3bf" title="Maximum string length for error message.">CF_MAXERRSTR</a>+1];
    <span class="keywordtype">char</span> *savemode = <span class="stringliteral">"w"</span>;
    FILE *error_log = stderr;

    <span class="comment">/* Hardcoded Configuration Setup and Defaults */</span>
    <a class="code" href="struct_c_o_n_f_i_g.html" title="CFLIB Configuration Database Entry.">CONFIG</a> setting[] =
    {   { <span class="stringliteral">"FILL_INFILE"</span>,   <a class="code" href="group__cflib__core.html#g070d2ce7b6bb7e5c05602aa8c308d0c4" title="NULL, if not defined.">NULL</a>,             <span class="charliteral">'i'</span>, 0x0,                        },
        { <span class="stringliteral">"FILL_OUTFILE"</span>,  <a class="code" href="group__cflib__core.html#g070d2ce7b6bb7e5c05602aa8c308d0c4" title="NULL, if not defined.">NULL</a>,             <span class="charliteral">'o'</span>, 0x0,                        },
        { <span class="stringliteral">"FILL_VARDELIM"</span>, <span class="stringliteral">"$()"</span>,            <span class="charliteral">'l'</span>, <a class="code" href="group__special__options__mask.html#g9e526dae88bf6803772107ff283637b5" title="Argument is concatenated to option.">CF_CONCAT</a>,                  },
        { <span class="stringliteral">"verb"</span>,          <a class="code" href="group__cflib__core.html#g7010abac2c80c121772da4d9c03332ee" title="Flag is not set.">CF_FLAG_OFF</a>,      <span class="charliteral">'v'</span>, <a class="code" href="group__special__options__mask.html#g72b75851880f36aaa5a52fdfe7960cca" title="Do not check environment for variable.">CF_IGN_ENV</a>|<a class="code" href="group__special__options__mask.html#g1d1f1d1b6eac6b5d9970102318ab2667" title="Entry is Flag.">CF_FLAG</a>,         },
        { <span class="stringliteral">"help"</span>,          <a class="code" href="group__cflib__core.html#g7010abac2c80c121772da4d9c03332ee" title="Flag is not set.">CF_FLAG_OFF</a>,      <span class="charliteral">'h'</span>, <a class="code" href="group__special__options__mask.html#g72b75851880f36aaa5a52fdfe7960cca" title="Do not check environment for variable.">CF_IGN_ENV</a>|<a class="code" href="group__special__options__mask.html#g1d1f1d1b6eac6b5d9970102318ab2667" title="Entry is Flag.">CF_FLAG</a>|<a class="code" href="group__special__options__mask.html#gd76153c65f68cc0ee5c1a04c8c3e80bf" title="Don&amp;#39;t include in savefile / mark entry.">CF_NOSAVE</a>,},
        { <span class="stringliteral">"query"</span>,         <a class="code" href="group__cflib__core.html#g7010abac2c80c121772da4d9c03332ee" title="Flag is not set.">CF_FLAG_OFF</a>,      <span class="charliteral">'q'</span>, <a class="code" href="group__special__options__mask.html#g72b75851880f36aaa5a52fdfe7960cca" title="Do not check environment for variable.">CF_IGN_ENV</a>|<a class="code" href="group__special__options__mask.html#g1d1f1d1b6eac6b5d9970102318ab2667" title="Entry is Flag.">CF_FLAG</a>,         },
        { <span class="stringliteral">"TIME"</span>,          <a class="code" href="group__cflib__core.html#g070d2ce7b6bb7e5c05602aa8c308d0c4" title="NULL, if not defined.">NULL</a>,             <span class="charliteral">'t'</span>, <a class="code" href="group__special__options__mask.html#g0fde537a92deb77f75b21c9e8d306509" title="Time string.">CF_TIME</a>|<a class="code" href="group__special__options__mask.html#g8d6cd1608fef5638efe964da63edf2dd" title="Source: Function Call.">CF_SET_PUT</a>,         },
        { <span class="stringliteral">"DATE"</span>,          <a class="code" href="group__cflib__core.html#g070d2ce7b6bb7e5c05602aa8c308d0c4" title="NULL, if not defined.">NULL</a>,             <span class="charliteral">'d'</span>, <a class="code" href="group__special__options__mask.html#g1c5b511a34d2c0db6631539ba81a4386" title="Date string.">CF_DATE</a>|<a class="code" href="group__special__options__mask.html#g8d6cd1608fef5638efe964da63edf2dd" title="Source: Function Call.">CF_SET_PUT</a>,         },
        { <span class="stringliteral">"FILL_CNF"</span>,      DEF_SETFILE,      <span class="charliteral">'p'</span>, <a class="code" href="group__special__options__mask.html#gfeeb63d4d8c498bec4a237ad8b94f02f" title="Entry is Private Configuration File.">CF_SETFILE</a>,                 },
        { <span class="stringliteral">"FILL_SAVE"</span>,     <a class="code" href="group__cflib__core.html#g070d2ce7b6bb7e5c05602aa8c308d0c4" title="NULL, if not defined.">NULL</a>,             <span class="charliteral">'s'</span>, <a class="code" href="group__special__options__mask.html#g72b75851880f36aaa5a52fdfe7960cca" title="Do not check environment for variable.">CF_IGN_ENV</a>|<a class="code" href="group__special__options__mask.html#g9e526dae88bf6803772107ff283637b5" title="Argument is concatenated to option.">CF_CONCAT</a>,       },
        { <span class="stringliteral">"SAVE_DATA"</span>,     <a class="code" href="group__cflib__core.html#g7010abac2c80c121772da4d9c03332ee" title="Flag is not set.">CF_FLAG_OFF</a>,      <span class="charliteral">'x'</span>, <a class="code" href="group__special__options__mask.html#g1d1f1d1b6eac6b5d9970102318ab2667" title="Entry is Flag.">CF_FLAG</a>|<a class="code" href="group__special__options__mask.html#g72b75851880f36aaa5a52fdfe7960cca" title="Do not check environment for variable.">CF_IGN_ENV</a>,         },
        { <span class="stringliteral">"SFILE"</span>,         DEF_SYS_SETFILE,  <span class="charliteral">' '</span>, <a class="code" href="group__special__options__mask.html#gbb03ea68e07e388da2c1337a1582c72e" title="Entry is System Configuration File.">CF_SYS_SETFILE</a>,             },
        { <span class="stringliteral">"FILL_SECTION"</span>,  <span class="stringliteral">"fill_default"</span>,   <span class="charliteral">'c'</span>, <a class="code" href="group__special__options__mask.html#g603f0467f101b71f5f869381429ffef4" title="Section in Configuration File.">CF_SECTION</a>|<a class="code" href="group__special__options__mask.html#ga4d82cea91ede4aee78594417894e368" title="Last entry in settings array.">CF_LAST</a>,         },
    };

    <span class="comment">/* Initialize with Error Reporting */</span>
    <span class="keywordflow">if</span>( <a class="code" href="group__cflib__core.html#ge593ff607f853bd5fc16a16bb6759314" title="Initialize CFLIB Configuration Database and parse possible sources for database entries...">cfinit</a>(setting,argc,argv) &lt; 0 ){
        <span class="keywordflow">while</span>( (ecode=<a class="code" href="group__errors.html#g2dc49b60b3ec7a82086e60f4b1c41e18" title="Error Code and Message Inquiry Function.">cfgeterr</a>(line,0)) == <a class="code" href="group__cflib__core.html#ga8cecfc5c5c054d2875c03e77b7be15d" title="TRUE, if not defined.">TRUE</a> )
            fprintf( error_log, <span class="stringliteral">"error %d: %s"</span>, ecode, line );
        fflush(error_log);
        fputs( <a class="code" href="group__retrieval.html#ge272c1881db940e56c8cc364df730271" title="Get Usage Message for (Terminal) Output.">cfgetusg</a>(), stderr );
        <span class="keywordflow">return</span> (-1);
    }

    <span class="comment">/* User Help and Configuration Overview */</span>
    <span class="keywordflow">if</span>( <a class="code" href="group__retrieval.html#gc0188464b59267e14b5c44efb1d4a0f2" title="Inquire CFLIB DB for Flag value in content of named entry.">cfgetflag</a>(<span class="stringliteral">"help"</span>) ){
        fputs( <a class="code" href="group__retrieval.html#ge272c1881db940e56c8cc364df730271" title="Get Usage Message for (Terminal) Output.">cfgetusg</a>(), stderr );
        <span class="keywordflow">if</span>( <a class="code" href="group__retrieval.html#gc0188464b59267e14b5c44efb1d4a0f2" title="Inquire CFLIB DB for Flag value in content of named entry.">cfgetflag</a>(<span class="stringliteral">"verbose"</span>) ){
            fprintf( stderr, <span class="stringliteral">"\nConfiguration Library PL %d - %s\n\nCurrent Configuration:\n\n"</span>,
                             <a class="code" href="group__retrieval.html#gc4e376e3630e9b25655ee0e0b1a54a5b" title="Get Library Version/Patchlevel.">cfgetvers</a>(), <a class="code" href="group__retrieval.html#g9999522b2acf8760f420d2567e7f7c50" title="Get Copyright Notice.">cfgetcpr</a>() );
            <a class="code" href="group__advanced__features.html#gecfc8ee37366e1b36cb5aac0cc41ebdc" title="Debugging Function.">cfdump</a>(stderr);
            fputs( <span class="stringliteral">"\nSources: 1=update function call, 2=commandline argument, 4=environment variable,\n"</span>, stderr );
            fputs(   <span class="stringliteral">"         8=private setfile, 10=system setfile, 20=built-in default, 40=interactive terminal input\n"</span>, stderr );
        }
        <span class="keywordflow">return</span> (1);
    }

    <span class="keywordflow">switch</span>(
        <a class="code" href="group__report__generation.html#g2f8350e7d032c87b2a0e1cb6149a85ec" title="Process a Template from file or stdin and write generated Report to File or stdout...">cfform</a>( infile = <a class="code" href="group__retrieval.html#g8cf5f53c5b05ec5ca4f5145010f84eb4" title="Inquire CFLIB DB for String in content of named entry.">cfgetstr</a>(<span class="stringliteral">"FILL_INFILE"</span>),
                outfile = <a class="code" href="group__retrieval.html#g8cf5f53c5b05ec5ca4f5145010f84eb4" title="Inquire CFLIB DB for String in content of named entry.">cfgetstr</a>(<span class="stringliteral">"FILL_OUTFILE"</span>),
                <a class="code" href="group__retrieval.html#g8cf5f53c5b05ec5ca4f5145010f84eb4" title="Inquire CFLIB DB for String in content of named entry.">cfgetstr</a>(<span class="stringliteral">"FILL_VARDELIM"</span>),
                <a class="code" href="group__retrieval.html#gc0188464b59267e14b5c44efb1d4a0f2" title="Inquire CFLIB DB for Flag value in content of named entry.">cfgetflag</a>(<span class="stringliteral">"query"</span>) )
    ){
        <span class="keywordflow">case</span> <a class="code" href="group__errors.html#ga3d4c51112fd70d482a4a77c95dc3daf" title="File Not Found, read access error.">CFE_FNF</a>:
            fprintf(stderr,<span class="stringliteral">"read access error: %s\n"</span>,infile); <span class="keywordflow">break</span>;
        <span class="keywordflow">case</span> <a class="code" href="group__errors.html#gd1375fe531ed1c13233e2fa7ae55534f" title="Write Access Error.">CFE_WAE</a>:
            fprintf(stderr,<span class="stringliteral">"write access error: %s\n"</span>,outfile); <span class="keywordflow">break</span>;
    }

    <span class="keywordflow">if</span>( <a class="code" href="group__retrieval.html#gc0188464b59267e14b5c44efb1d4a0f2" title="Inquire CFLIB DB for Flag value in content of named entry.">cfgetflag</a>(<span class="stringliteral">"verb"</span>) ){
        <span class="keywordflow">if</span>( outfile == <a class="code" href="group__cflib__core.html#g070d2ce7b6bb7e5c05602aa8c308d0c4" title="NULL, if not defined.">NULL</a> ) outfile = <span class="stringliteral">"&lt;stdout&gt;"</span>;
        fprintf( stderr, <span class="stringliteral">"blank form: %s, filled form: %s\n"</span>, infile, outfile );
    }

    <span class="keywordflow">if</span>( <a class="code" href="group__retrieval.html#gc0188464b59267e14b5c44efb1d4a0f2" title="Inquire CFLIB DB for Flag value in content of named entry.">cfgetflag</a>(<span class="stringliteral">"SAVE_DATA"</span>) ){
        <a class="code" href="group__setting__saving.html#g0f6ed90e3ecfa0074af1635a0e4339ef" title="Alter or query the CF_NOSAVE Flag of Parameter name.">cfnosave</a>(<a class="code" href="group__cflib__core.html#g070d2ce7b6bb7e5c05602aa8c308d0c4" title="NULL, if not defined.">NULL</a>, <a class="code" href="group__cflib__core.html#g355c714f2912ac336b8b03468c978d8c" title="Flag is set.">CF_FLAG_ON</a>);
        <a class="code" href="group__setting__saving.html#g0f6ed90e3ecfa0074af1635a0e4339ef" title="Alter or query the CF_NOSAVE Flag of Parameter name.">cfnosave</a>(<span class="stringliteral">"TIME"</span>, <a class="code" href="group__cflib__core.html#g7010abac2c80c121772da4d9c03332ee" title="Flag is not set.">CF_FLAG_OFF</a>);
        <a class="code" href="group__setting__saving.html#g0f6ed90e3ecfa0074af1635a0e4339ef" title="Alter or query the CF_NOSAVE Flag of Parameter name.">cfnosave</a>(<span class="stringliteral">"DATE"</span>, <a class="code" href="group__cflib__core.html#g7010abac2c80c121772da4d9c03332ee" title="Flag is not set.">CF_FLAG_OFF</a>);
    }
    <span class="keywordflow">if</span>( (save = <a class="code" href="group__retrieval.html#g8cf5f53c5b05ec5ca4f5145010f84eb4" title="Inquire CFLIB DB for String in content of named entry.">cfgetstr</a>(<span class="stringliteral">"FILL_SAVE"</span>)) != <a class="code" href="group__cflib__core.html#g070d2ce7b6bb7e5c05602aa8c308d0c4" title="NULL, if not defined.">NULL</a> ){
        <span class="keywordflow">if</span>( <a class="code" href="group__retrieval.html#gc0188464b59267e14b5c44efb1d4a0f2" title="Inquire CFLIB DB for Flag value in content of named entry.">cfgetflag</a>(<span class="stringliteral">"SAVE_DATA"</span>) ) savemode = <span class="stringliteral">"a"</span>;
        <span class="keywordflow">if</span>( *save == <span class="charliteral">'\0'</span> )
            <a class="code" href="group__setting__saving.html#g046d8a68eae35b987eacca04a9a06cca" title="Write configuration data to a Configuration File or stdout.">cfsave</a>( <a class="code" href="group__cflib__core.html#g070d2ce7b6bb7e5c05602aa8c308d0c4" title="NULL, if not defined.">NULL</a>, savemode );
        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( *save == <span class="charliteral">'+'</span> )
            <a class="code" href="group__setting__saving.html#g046d8a68eae35b987eacca04a9a06cca" title="Write configuration data to a Configuration File or stdout.">cfsave</a>( <span class="stringliteral">""</span>, savemode );
        <span class="keywordflow">else</span>
            <a class="code" href="group__setting__saving.html#g046d8a68eae35b987eacca04a9a06cca" title="Write configuration data to a Configuration File or stdout.">cfsave</a>( save, savemode );
    }

    <span class="keywordflow">return</span> (0);
}
</pre></div> </div>
<hr size="1"><address style="text-align: right;"><small>Generated on Wed Jan 28 20:22:57 2009 for CFLIB - Flexible Configuration Library by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.8 </small></address>
</body>
</html>
